/*!
 * Animation Image Splitter v2.0.1 | MIT Licence | 2014 Kenta Moriuchi (@printf_moriken) | http://git.io/bSTspQ
 *
 * This Program is inspired by APNG-canvas.
 * @copyright 2011 David Mzareulyan
 * @link https://github.com/davidmz/apng-canvas
 * @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
 */
!function(r,t){"use strict";function e(){}function n(r,t){this.width=0,this.height=0,this.frames=[],this.type=t,this._onload=[],this._onerror=[],this._onprogress=[],this.loaded=!1,this._urlToFrames(r,t)}function s(r){for(var t=0,e=0;4>e;++e)t+=r.charCodeAt(e)<<8*(3-e);return t}function o(r){for(var t=0,e=0;2>e;++e)t+=r.charCodeAt(e)<<8*(1-e);return t}function i(r,t){var e="";return e+=a(t.length),e+=r,e+=t,e+=a(u(r+t))}function a(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,255&r)}function h(){this.parts=[]}function u(r){for(var t=-1,e=0,n=r.length;n>e;++e)t=t>>>8^l[255&(t^r.charCodeAt(e))];return-1^t}var p=function(){var r=new XMLHttpRequest;r.open("get","/",!0);try{r.responseType="blob"}catch(e){return!1}return r.response!==t&&"blob"===r.responseType}(),f=navigator.userAgent.match(/msie [9.]/i);f&&document.addEventListener("DOMContentLoaded",function(){var r=document.createElement("script");r.setAttribute("type","text/vbscript"),r.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(r)}),e.prototype.read=function(r,t){var e=new n(r,t);return e},r.AISplitter=e,n.prototype.on=function(r,t){if("load"!==r&&"error"!==r&&"progress"!==r)throw new Error("Don't exist '"+r+"' event");this["_on"+r].push(t)},n.prototype.off=function(r,e){if("load"!==r&&"error"!==r&&"progress"!==r)throw new Error("Don't exist '"+r+"' event");var n=this["_on"+r];if("function"==typeof e)for(var s=0,o=n.length;o>s;++s)n[s]===e&&n.splice(s,1);else e===t&&n.splice(0,n.length)},n.prototype.trigger=function(r,e){if("load"!==r&&"error"!==r&&"progress"!==r)throw new Error("Don't exist '"+r+"' event");e=e||[],e.frames=this.frames,e.number=e.number!==t?e.number:null,e.frame=e.frame||null,e.error=e.error||null;for(var n=this["_on"+r],s=0,o=n.length;o>s;++s)n[s].call(this,e)},n.prototype._loadend=function(){this.loaded=!0,this.trigger("load")},n.prototype._urlToFrames=function(r,e){var n=this,s=new XMLHttpRequest,o=s.responseType!==t;s.open("GET",r,!0),o?s.responseType=p?"blob":"arraybuffer":s.overrideMimeType("text/plain; charset=x-user-defined"),s.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(o)if(p){var r=new FileReader;r.readAsBinaryString!==t?(r.onload=function(){n._switchType(this.result,e)},r.readAsBinaryString(this.response)):(r.onload=function(){for(var r="",t=new Uint8Array(this.result),s=t.byteLength,o=0;s>o;++o)r+=String.fromCharCode(t[o]);n._switchType(r,e)},r.readAsArrayBuffer(this.response))}else{for(var s="",i=new Uint8Array(this.response),a=i.byteLength,h=0;a>h;++h)s+=String.fromCharCode(i[h]);n._switchType(s,e)}else{var u="";if(f)for(var d=IEBinaryToBinStr(this.responseBody),h=0,g=d.length;g>h;++h){var l=d.charCodeAt(h);u+=String.fromCharCode(255&l,l>>8&255)}else for(var s=this.responseText,h=0,c=s.length;c>h;++h)u+=String.fromCharCode(255&s.charCodeAt(h));n._switchType(u,e)}else 4==this.readyState&&n.trigger("error",{error:"Can't read file"})},s.send()},n.prototype._switchType=function(r,t){"APNG"===t?this._parseAPNG(r):"XJPEG"===t?this._parseXJPEG(r):this.trigger("error",{error:"Don't support type"})},n.prototype._parseAPNG=function(r){function t(r,t){return function(){++w,C.trigger("progress",{number:r,frame:t}),w===C.frames.length&&C._loadend()}}function e(){C.trigger("error",{error:"Image creation error"})}if(r.substr(0,8)!==d)return void this.trigger("error",{error:"This file is not PNG"});var n,u,p,f,g="",l="",c=!1,m=8,y=null;do{switch(u=s(r.substr(m,4)),p=r.substr(m+4,4)){case"IHDR":f=r.substr(m+8,u),n=f,this.width=s(f.substr(0,4)),this.height=s(f.substr(4,4));break;case"acTL":c=!0,this.numPlays=s(r.substr(m+12,4));break;case"fcTL":y&&this.frames.push(y),f=r.substr(m+8,u),y={},y.width=s(f.substr(4,4)),y.height=s(f.substr(8,4)),y.left=s(f.substr(12,4)),y.top=s(f.substr(16,4));var b=o(f.substr(20,2)),v=o(f.substr(22,2));0===v&&(v=100),y.delay=1e3*b/v,y.delay<=10&&(y.delay=100),this.playTime+=y.delay,y.disposeOp=f.charCodeAt(24),y.blendOp=f.charCodeAt(25),y.dataParts=[];break;case"fdAT":y&&y.dataParts.push(r.substr(m+12,u-4));break;case"IDAT":y&&y.dataParts.push(r.substr(m+8,u));break;case"IEND":l=r.substr(m,u+12);break;default:g+=r.substr(m,u+12)}m+=u+12}while("IEND"!==p&&m<r.length);if(y&&this.frames.push(y),y=null,!c)return void this.trigger("error",{error:"Non-animated PNG"});for(var w=0,C=this,T=0,A=this.frames.length;A>T;++T){var S=new Image;y=this.frames[T],y.img=S,S.onload=t(T,y),S.onerror=e;var _=new h;_.append(d),n=a(y.width)+a(y.height)+n.substr(8),_.append(i("IHDR",n)),_.append(g);for(var E=0;E<y.dataParts.length;++E)_.append(i("IDAT",y.dataParts[E]));_.append(l),S.src=_.getUrl("image/png"),delete y.dataParts}},n.prototype._parseXJPEG=function(r){function t(r,t){return function(){++y,n.trigger("progress",{number:r,frame:t}),y===n.frames.length&&n._loadend()}}function e(){n.trigger("error",{error:"Image creation error"})}var n=this,s=String.fromCharCode(255),i=s+String.fromCharCode(216),a=s+String.fromCharCode(217),u=r.match(new RegExp(i+"[\\s\\S]+?"+a,"g"));if(!("length"in u))return void this.trigger("error",{error:"Can't read JPEG Binary String"});for(var p=function(){if(r.substr(9,12)!==g)return null;for(var t=0,e=1,s=0;4>s;++s)t+=r.charCodeAt(32+s)*e,e*=256;return t/=1e3,n.playTime=0,t}(),f=function(){for(var r=[],t=192;207>=t;)196!==t&&200!==t&&204!==t&&r.push(String.fromCharCode(t)),++t;return new RegExp(s+"["+r.join("")+"]")}(),d=0,l=u.length;l>d;++d){var c={},m=u[d].search(f);c.height=o(u[d].substr(m+5,2)),c.width=o(u[d].substr(m+7,2)),0===d?(this.height=c.height,this.width=c.width,c.top=c.left=0):(c.top=(this.height-c.height)/2,c.left=(this.width-c.width)/2),null!==p&&(c.delay=p,this.playTime+=p),this.frames.push(c)}if(u.length!==this.frames.length)return void this.trigger("error",{error:"Shotage JPEG SOF data"});for(var y=0,d=0,l=this.frames.length;l>d;++d){var b=new Image,c=this.frames[d];c.img=b,b.onload=t(d,c),b.onerror=e;var v=new h;v.append(u[d]),b.src=v.getUrl("image/jpeg")}};var d=String.fromCharCode(137,80,78,71,13,10,26,10),g="AVI ";h.prototype.append=function(r){this.parts.push(r)},h.prototype.getUrl=function(t){return r.btoa?"data:"+t+";base64,"+btoa(this.parts.join("")):"data:"+t+","+escape(this.parts.join(""))};for(var l=new Array(256),c=0;256>c;++c){for(var m=c,y=0;8>y;++y)m=1&m?3988292384^m>>>1:m>>>1;l[c]=m}}(this);