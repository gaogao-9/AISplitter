/*!
 * Animation Image Splitter v1.0.2 | MIT Licence | 2014 Kenta Moriuchi (@printf_moriken)
 *
 * This Program is inspired by APNG-canvas.
 * @copyright 2011 David Mzareulyan
 * @link https://github.com/davidmz/apng-canvas
 * @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
 */
!function(t){"use strict";function r(){}function e(t,r){this.width=0,this.height=0,this.frames=[],this._onload=[],this.loaded=!1,this._urlToFrames(t,r)}function n(t){for(var r=0,e=0;4>e;++e)r+=t.charCodeAt(e)<<8*(3-e);return r}function a(t){for(var r=0,e=0;2>e;++e)r+=t.charCodeAt(e)<<8*(1-e);return r}function o(t,r){var e="";return e+=s(r.length),e+=t,e+=r,e+=s(h(t+r))}function s(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}function i(){this.parts=[]}function h(t){for(var r=-1,e=0,n=t.length;n>e;++e)r=r>>>8^p[255&(r^t.charCodeAt(e))];return-1^r}var d=navigator.userAgent.match(/msie [9.]/i);d&&document.addEventListener("DOMContentLoaded",function(){var t=document.createElement("script");t.setAttribute("type","text/vbscript"),t.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(t)}),r.prototype.read=function(t,r){var n=new e(t,r);return n},t.AISplitter=r,e.prototype.on=function(t,r){if("load"!==t)throw new Error("Don't exist '"+t+"' event");this._onload.push(r)},e.prototype.off=function(t,r){if("load"!==t)throw new Error("Don't exist '"+t+"' event");if("function"==typeof r)for(var e=0,n=this._onload.length;n>e;++e)this._onload[e]===r&&this._onload.splice(e,1);else"undefined"==typeof r&&(this._onload=[])},e.prototype._urlToFrames=function(t,r){var e=this,n=new XMLHttpRequest,a="responseType"in n,o="overrideMimeType"in n;n.open("GET",t,!0),a?n.responseType="blob":o&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(a){var t=new FileReader;"readAsBinaryString"in t?(t.onload=function(){e._switchType(this.result,r)},t.readAsBinaryString(this.response)):(t.onload=function(){for(var t="",n=new Uint8Array(this.result),a=n.byteLength,o=0;a>o;++o)t+=String.fromCharCode(n[o]);e._switchType(t,r)},t.readAsArrayBuffer(this.response))}else{var n="";if(d)for(var o=IEBinaryToBinStr(this.responseBody),s=0,i=o.length;i>s;++s){var h=o.charCodeAt(s);n+=String.fromCharCode(255&h,h>>8&255)}else for(var f=this.responseText,p=0,u=f.length;u>p;++p)n+=String.fromCharCode(255&f.charCodeAt(p));e._switchType(n,r)}else if(4==this.readyState)throw new Error("Can't read file")},n.send()},e.prototype._switchType=function(t,r){if("APNG"===r)this._parseAPNG(t);else{if("XJPEG"!==r)throw new Error("Don't support type");this._parseXJPEG(t)}},e.prototype._parseAPNG=function(t){if(t.substr(0,8)!==f)throw new TypeError("This file is not PNG");var r,e,h,d,p="",u="",l=!1,c=8,g=null;do{switch(e=n(t.substr(c,4)),h=t.substr(c+4,4)){case"IHDR":d=t.substr(c+8,e),r=d,this.width=n(d.substr(0,4)),this.height=n(d.substr(4,4));break;case"acTL":l=!0,this.numPlays=n(t.substr(c+12,4));break;case"fcTL":g&&this.frames.push(g),d=t.substr(c+8,e),g={},g.width=n(d.substr(4,4)),g.height=n(d.substr(8,4)),g.left=n(d.substr(12,4)),g.top=n(d.substr(16,4));var y=a(d.substr(20,2)),m=a(d.substr(22,2));0===m&&(m=100),g.delay=1e3*y/m,g.delay<=10&&(g.delay=100),this.playTime+=g.delay,g.disposeOp=d.charCodeAt(24),g.blendOp=d.charCodeAt(25),g.dataParts=[];break;case"fdAT":g&&g.dataParts.push(t.substr(c+12,e-4));break;case"IDAT":g&&g.dataParts.push(t.substr(c+8,e));break;case"IEND":u=t.substr(c,e+12);break;default:p+=t.substr(c,e+12)}c+=e+12}while("IEND"!==h&&c<t.length);if(g&&this.frames.push(g),g=null,!l)throw new TypeError("Non-animated PNG");for(var w=0,v=this,b=0,C=this.frames.length;C>b;++b){var E=new Image;g=this.frames[b],g.img=E,E.onload=function(){++w,w===v.frames.length&&v._loadend()},E.onerror=function(){throw new Error("Image creation error")};var T=new i;T.append(f),r=s(g.width)+s(g.height)+r.substr(8),T.append(o("IHDR",r)),T.append(p);for(var A=0;A<g.dataParts.length;++A)T.append(o("IDAT",g.dataParts[A]));T.append(u),E.src=T.getUrl("image/png"),delete g.dataParts}},e.prototype._parseXJPEG=function(t){var r=String.fromCharCode(255),e=r+String.fromCharCode(216),n=r+String.fromCharCode(217),o=t.match(new RegExp(e+"[\\s\\S]+?"+n,"g"));if(!("length"in o))throw new Error("Can't read Binary String");for(var s,h=0,d=o.length;d>h;++h){for(var f=[],p=192;207>=p;)196!==p&&200!==p&&204!==p&&f.push(String.fromCharCode(p)),++p;s={};var u=o[h].search(new RegExp(r+"["+f.join("")+"]"));s.height=a(o[h].substr(u+5,2)),s.width=a(o[h].substr(u+7,2)),s.top=s.left=0,this.frames.push(s)}if(o.length!==this.frames.length)throw new TypeError("Shotage JPEG SOF data");this.height=this.frames[0].height,this.width=this.frames[0].width;for(var l=0,c=this,h=0,d=this.frames.length;d>h;++h){var g=new Image;this.frames[h].img=g,g.onload=function(){++l,l===c.frames.length&&c._loadend()},g.onerror=function(){throw new Error("Image creation error")};var y=new i;y.append(o[h]),g.src=y.getUrl("image/jpeg")}},e.prototype._loadend=function(){this.loaded=!0;for(var t=0,r=this._onload.length;r>t;++t)this._onload[t].call(this)};var f=String.fromCharCode(137,80,78,71,13,10,26,10);i.prototype.append=function(t){this.parts.push(t)},i.prototype.getUrl=function(r){return t.btoa?"data:"+r+";base64,"+btoa(this.parts.join("")):"data:"+r+","+escape(this.parts.join(""))};for(var p=new Array(256),u=0;256>u;++u){for(var l=u,c=0;8>c;++c)l=1&l?3988292384^l>>>1:l>>>1;p[u]=l}}(this);