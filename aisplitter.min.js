/*!
 * Animation Image Splitter v1.0.0 | MIT Licence | 2014 Kenta Moriuchi (@printf_moriken)
 *
 * This Program is inspired by APNG-canvas.
 * @copyright 2011 David Mzareulyan
 * @link https://github.com/davidmz/apng-canvas
 * @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
 */
!function(t){"use strict";function r(){}function e(t,r){this.width=0,this.height=0,this.numPlays=0,this.frames=[],this.playTime=0,this._onload=[],this.loaded=!1,this._urlToFrames(t,r)}function a(t){for(var r=0,e=0;4>e;++e)r+=t.charCodeAt(e)<<8*(3-e);return r}function s(t){for(var r=0,e=0;2>e;++e)r+=t.charCodeAt(e)<<8*(1-e);return r}function n(t,r){var e="";return e+=o(r.length),e+=t,e+=r,e+=o(h(t+r))}function o(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}function i(){this.parts=[]}function h(t){for(var r=-1,e=0,a=t.length;a>e;++e)r=r>>>8^u[255&(r^t.charCodeAt(e))];return-1^r}var d=navigator.userAgent.match(/msie [9.]/i);d&&document.addEventListener("DOMContentLoaded",function(){var t=document.createElement("script");t.setAttribute("type","text/vbscript"),t.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(t)}),r.prototype.read=function(t,r){var a=new e(t,r);return a},t.AISplitter=r,e.prototype.on=function(t,r){"load"===t&&this._onload.push(r)},e.prototype._urlToFrames=function(t,r){var e=this,a=new XMLHttpRequest,s="responseType"in a,n="overrideMimeType"in a;a.open("GET",t,!0),s?a.responseType="blob":n&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(s){var t=new FileReader;"readAsBinaryString"in t?(t.onload=function(){e._switchType(this.result,r)},t.readAsBinaryString(this.response)):(t.onload=function(){for(var t="",a=new Uint8Array(this.result),s=a.byteLength,n=0;s>n;++n)t+=String.fromCharCode(a[n]);e._switchType(t,r)},t.readAsArrayBuffer(this.response))}else{var a="";if(d)for(var n=IEBinaryToBinStr(this.responseBody),o=0,i=n.length;i>o;++o){var h=n.charCodeAt(o);a+=String.fromCharCode(255&h,h>>8&255)}else for(var p=this.responseText,u=0,f=p.length;f>u;++u)a+=String.fromCharCode(255&p.charCodeAt(u));e._switchType(a,r)}else if(4==this.readyState)throw new Error("Can't read APNG date")},a.send()},e.prototype._switchType=function(t,r){"image/png"===r?this._parseAPNG(t):"image/jpeg"===r&&this._parseMJPEG(t)},e.prototype._parseAPNG=function(t){if(t.substr(0,8)!==p)throw new TypeError("This File is not PNG");var r,e,h,d,u="",f="",l=!1,c=8,g=null;do{switch(e=a(t.substr(c,4)),h=t.substr(c+4,4)){case"IHDR":d=t.substr(c+8,e),r=d,this.width=a(d.substr(0,4)),this.height=a(d.substr(4,4));break;case"acTL":l=!0,this.numPlays=a(t.substr(c+12,4));break;case"fcTL":g&&this.frames.push(g),d=t.substr(c+8,e),g={},g.width=a(d.substr(4,4)),g.height=a(d.substr(8,4)),g.left=a(d.substr(12,4)),g.top=a(d.substr(16,4));var m=s(d.substr(20,2)),y=s(d.substr(22,2));0===y&&(y=100),g.delay=1e3*m/y,g.delay<=10&&(g.delay=100),this.playTime+=g.delay,g.disposeOp=d.charCodeAt(24),g.blendOp=d.charCodeAt(25),g.dataParts=[];break;case"fdAT":g&&g.dataParts.push(t.substr(c+12,e-4));break;case"IDAT":g&&g.dataParts.push(t.substr(c+8,e));break;case"IEND":f=t.substr(c,e+12);break;default:u+=t.substr(c,e+12)}c+=e+12}while("IEND"!==h&&c<t.length);if(g&&this.frames.push(g),g=null,!l)throw new TypeError("Non-animated PNG");for(var b=0,v=this,w=0,C=this.frames.length;C>w;++w){var T=new Image;g=this.frames[w],g.img=T,T.onload=function(){++b,b==v.frames.length&&v._loadend()},T.onerror=function(){throw new Error("Image creation error")};var A=new i;A.append(p),r=o(g.width)+o(g.height)+r.substr(8),A.append(n("IHDR",r)),A.append(u);for(var S=0;S<g.dataParts.length;++S)A.append(n("IDAT",g.dataParts[S]));A.append(f),T.src=A.getUrl("image/png"),delete g.dataParts}},e.prototype._parseMJPEG=function(t){for(var r=String.fromCharCode(255),e=r+String.fromCharCode(216),a=r+String.fromCharCode(217),n=0,o=1,h=0;4>h;++h)n+=t.charCodeAt(32+h)*o,o*=256;n/=1e3;for(var d,p=t.match(new RegExp(e+"[\\s\\S]+?"+a,"g")),u=0,f=p.length;f>u;++u){for(var l=[],c=192;207>=c;)196!==c&&200!==c&&204!==c&&l.push(String.fromCharCode(c)),++c;d={};var g=p[u].search(new RegExp(r+"["+l.join("")+"]"));d.height=s(p[u].substr(g+5,2)),d.width=s(p[u].substr(g+7,2)),d.top=d.left=0,d.delay=n,this.playTime+=n,this.frames.push(d)}if(p.length!==this.frames.length)throw new Error("Shotage MJPG SOF data");this.height=this.frames[0].height,this.width=this.frames[0].width;var m=0,y=this,b=0;for(this.frames.length;f>b;++b){var v=new Image;this.frames[b].img=v,v.onload=function(){++m,m==y.frames.length&&y._loadend()},v.onerror=function(){throw new Error("Image creation error")};var w=new i;w.append(p[b]),v.src=w.getUrl("image/jpeg")}},e.prototype._loadend=function(){this.loaded=!0;for(var t=0,r=this._onload.length;r>t;++t)this._onload.shift().call(this);delete this._onload};var p=String.fromCharCode(137,80,78,71,13,10,26,10);i.prototype.append=function(t){this.parts.push(t)},i.prototype.getUrl=function(r){return t.btoa?"data:"+r+";base64,"+btoa(this.parts.join("")):"data:"+r+","+escape(this.parts.join(""))};for(var u=new Array(256),f=0;256>f;++f){for(var l=f,c=0;8>c;++c)l=1&l?3988292384^l>>>1:l>>>1;u[f]=l}}(this);