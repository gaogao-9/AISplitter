/*!
 * Animation Image Splitter v2.0.2 | MIT Licence | 2014 Kenta Moriuchi (@printf_moriken) | http://git.io/bSTspQ
 *
 * This Program is inspired by APNG-canvas.
 * @copyright 2011 David Mzareulyan
 * @link https://github.com/davidmz/apng-canvas
 * @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
 */
!function(t,e){"use strict";function AISplitter(t){this._path="",this._isLoaded=!1,this.events={load:[],error:[]},this.path=t}function r(t){if(!this._isLoaded)switch(t){case"APNG":case"XJPEG":h.call(this,t);break;default:this.trigger("error",new Error("Don't support type"))}}function n(){return r.call(this,AISplitter.APNG)}function o(){return r.call(this,AISplitter.XJPEG)}function i(t,e){switch(t){case"load":case"error":this.events[t].push(e);break;default:throw new Error("Don't exist '"+t+"' event")}}function s(t,e){switch(t){case"load":case"error":if("function"!=typeof e){this.events[t].length=0;break}for(var r=this.events[t],n=r.length;n--;)r[n]===e&&r.splice(n,1);break;default:throw new Error("Don't exist '"+t+"' event")}}function a(t,e){switch(t){case"load":case"error":break;default:throw new Error("Don't exist '"+t+"' event")}for(var r=this.events[t],n=r.length;n--&&r[n].call(this,e)!==!1;);}function h(t){var r=this,n=new XMLHttpRequest;n.open("GET",this._path,!0),u?n.responseType=f?"blob":"arraybuffer":p&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(n){if(4===this.readyState){if(200!==this.status&&r.trigger("error",new error("Can't read file")),!u){var o="";if(g)for(var i=IEBinaryToBinStr(this.responseBody),s=0,a=i.length;a>s;++s){var h=i.charCodeAt(s);o+=String.fromCharCode(255&h,h>>8&255)}else for(var d=this.responseText,s=0,a=d.length;a>s;++s)o+=String.fromCharCode(255&d.charCodeAt(s));return r._isLoaded=!0,void r.trigger("load",new AISplitter.Movie(o,t))}if(!f){for(var d="",c=new Uint8Array(this.response),p=c.byteLength,s=0;p>s;++s)d+=String.fromCharCode(c[s]);return r._isLoaded=!0,void r.trigger("load",new AISplitter.Movie(d,t))}var l=new FileReader;if(l.readAsBinaryString!==e)return l.onload=function(){r._isLoaded=!0,r.trigger("load",new AISplitter.Movie(this.result,t))},void l.readAsBinaryString(this.response);l.onload=function(){for(var e="",n=new Uint8Array(this.result),o=n.byteLength,i=0;o>i;++i)e+=String.fromCharCode(n[i]);r._isLoaded=!0,r.trigger("load",new AISplitter.Movie(e,t))},l.readAsArrayBuffer(this.response)}},n.send()}function d(){var t=new XMLHttpRequest;if(u=t.responseType!==e,p=t.overrideMimeType!==e&&!u,!u)return void(f=!1);t.open("get","/",!0);try{t.responseType="blob"}catch(r){return void(f=!1)}f=t.response!==e&&"blob"===t.responseType}function c(){g&&document.addEventListener("DOMContentLoaded",function(){var t=document.createElement("script");t.setAttribute("type","text/vbscript"),t.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(t)})}t.AISplitter=AISplitter,AISplitter.prototype={set path(t){"string"==typeof t&&(this._path=t.toString())},get path(){return this._path},set isLoaded(t){},get isLoaded(){return this._isLoaded}},AISplitter.prototype.read=r,AISplitter.prototype.readAsAPNG=n,AISplitter.prototype.readAsXJPEG=o,AISplitter.prototype.on=i,AISplitter.prototype.off=s,AISplitter.prototype.trigger=a,AISplitter.APNG="APNG",AISplitter.XJPEG="XJPEG";var u,f,p;d();var g=navigator.userAgent.match(/msie [9.]/i);c()}((this||0).self||global),function(t,e){"use strict";function Movie(t,e){this._isSuccess=!1,this._width=0,this._height=0,this._type=t,this._binary=e,this._position=0,this._frameCount=0,_loadHeader.call(this)}function r(){return this._isLoaded?(this._offset=0,!0):!1}function n(){return this._isLoaded?void 0:!1}function o(t){for(var e=0,r=0;4>r;++r)e+=t.charCodeAt(r)<<8*(3-r);return e}function i(t){for(var e=0,r=0;2>r;++r)e+=t.charCodeAt(r)<<8*(1-r);return e}function s(t,e){var r="";return r+=a(e.length),r+=t,r+=e,r+=a(u(t+e))}function a(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}function h(){this.parts=[]}t.AISplitter.Movie=Movie,Movie.prototype={set binary(t){},get binary(){return this._binary},set type(t){},get type(){return this._type}},Movie.prototype.moveToFirstFrame=r,Movie.prototype.getNextFrame=n,Frames.prototype._loadend=function(){this.trigger("load")},Frames.prototype._parseAPNG=function(t){function e(t,e){return function(){++w,A.trigger("progress",{number:t,frame:e}),w===A.frames.length&&A._loadend()}}function r(){A.trigger("error",{error:"Image creation error"})}if(t.substr(0,8)!==c)return void this.trigger("error",{error:"This file is not PNG"});var n,d,u,f,p="",g="",l=!1,b=8,v=null;do{switch(d=o(t.substr(b,4)),u=t.substr(b+4,4)){case"IHDR":f=t.substr(b+8,d),n=f,this.width=o(f.substr(0,4)),this.height=o(f.substr(4,4));break;case"acTL":l=!0,this.numPlays=o(t.substr(b+12,4));break;case"fcTL":v&&this.frames.push(v),f=t.substr(b+8,d),v={},v.width=o(f.substr(4,4)),v.height=o(f.substr(8,4)),v.left=o(f.substr(12,4)),v.top=o(f.substr(16,4));var y=i(f.substr(20,2)),m=i(f.substr(22,2));0===m&&(m=100),v.delay=1e3*y/m,v.delay<=10&&(v.delay=100),this.playTime+=v.delay,v.disposeOp=f.charCodeAt(24),v.blendOp=f.charCodeAt(25),v.dataParts=[];break;case"fdAT":v&&v.dataParts.push(t.substr(b+12,d-4));break;case"IDAT":v&&v.dataParts.push(t.substr(b+8,d));break;case"IEND":g=t.substr(b,d+12);break;default:p+=t.substr(b,d+12)}b+=d+12}while("IEND"!==u&&b<t.length);if(v&&this.frames.push(v),v=null,!l)return void this.trigger("error",{error:"Non-animated PNG"});for(var w=0,A=this,C=0,_=this.frames.length;_>C;++C){var E=new Image;v=this.frames[C],v.img=E,E.onload=e(C,v),E.onerror=r;var S=new h;S.append(c),n=a(v.width)+a(v.height)+n.substr(8),S.append(s("IHDR",n)),S.append(p);for(var j=0;j<v.dataParts.length;++j)S.append(s("IDAT",v.dataParts[j]));S.append(g),E.src=S.getUrl("image/png"),delete v.dataParts}},Frames.prototype._parseXJPEG=function(t){function e(t,e){return function(){++v,n.trigger("progress",{number:t,frame:e}),v===n.frames.length&&n._loadend()}}function r(){n.trigger("error",{error:"Image creation error"})}var n=this,o=String.fromCharCode(255),s=o+String.fromCharCode(216),a=o+String.fromCharCode(217),c=t.match(new RegExp(s+"[\\s\\S]+?"+a,"g"));if(!("length"in c))return void this.trigger("error",{error:"Can't read JPEG Binary String"});for(var u=function(){if(t.substr(9,12)!==d)return null;for(var e=0,r=1,o=0;4>o;++o)e+=t.charCodeAt(32+o)*r,r*=256;return e/=1e3,n.playTime=0,e}(),f=function(){for(var t=[],e=192;207>=e;)196!==e&&200!==e&&204!==e&&t.push(String.fromCharCode(e)),++e;return new RegExp(o+"["+t.join("")+"]")}(),p=0,g=c.length;g>p;++p){var l={},b=c[p].search(f);l.height=i(c[p].substr(b+5,2)),l.width=i(c[p].substr(b+7,2)),0===p?(this.height=l.height,this.width=l.width,l.top=l.left=0):(l.top=(this.height-l.height)/2,l.left=(this.width-l.width)/2),null!==u&&(l.delay=u,this.playTime+=u),this.frames.push(l)}if(c.length!==this.frames.length)return void this.trigger("error",{error:"Shotage JPEG SOF data"});for(var v=0,p=0,g=this.frames.length;g>p;++p){var y=new Image,l=this.frames[p];l.img=y,y.onload=e(p,l),y.onerror=r;var m=new h;m.append(c[p]),y.src=m.getUrl("image/jpeg")}};var d="AVI ",c=String.fromCharCode(137,80,78,71,13,10,26,10);h.prototype.append=function(t){this.parts.push(t)},h.prototype.getUrl=function(e){return t.btoa?"data:"+e+";base64,"+btoa(this.parts.join("")):"data:"+e+","+escape(this.parts.join(""))};var u=function(){for(var t=new Array(256),e=0;256>e;++e){for(var r=e,n=0;8>n;++n)r=1&r?3988292384^r>>>1:r>>>1;t[e]=r}return function(e){for(var r=-1,n=0,o=e.length;o>n;++n)r=r>>>8^t[255&(r^e.charCodeAt(n))];return-1^r}}()}((this||0).self||global),function(t,e){"use strict";function Frame(t){this._path="",this._isLoaded=!1,this._type="",this.events={load:[],error:[]},this.path=t}function r(t){if(!this._isLoaded)switch(t){case"APNG":this._type=Frame.APNG,h.call(this);break;case"XJPEG":this._type=Frame.XJPEG,h.call(this);break;default:this.trigger("error",{error:"Don't support type"})}}function n(){return r.call(this,Frame.APNG)}function o(){return r.call(this,Frame.XJPEG)}function i(t,e){switch(t){case"load":case"error":this.events[t].push(e);break;default:throw new Error("Don't exist '"+t+"' event")}}function s(t,e){switch(t){case"load":case"error":if("function"!=typeof e){this.events[t].length=0;break}for(var r=this.events[t],n=r.length;n--;)r[n]===e&&r.splice(n,1);break;default:throw new Error("Don't exist '"+t+"' event")}}function a(t,e){switch(t){case"load":case"error":e=e||{},e.error=e.error||null;break;default:throw new Error("Don't exist '"+t+"' event")}for(var r=this.events[t],n=r.length;n--&&r[n].call(this,obj)!==!1;);}function h(){var t=this,r=new XMLHttpRequest;r.open("GET",this._path,!0),u?r.responseType=f?"blob":"arraybuffer":p&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(r){if(4===this.readyState){if(200!==this.status&&t.trigger("error",{error:"Can't read file"}),!u){var n="";if(g)for(var o=IEBinaryToBinStr(this.responseBody),i=0,s=o.length;s>i;++i){var a=o.charCodeAt(i);n+=String.fromCharCode(255&a,a>>8&255)}else for(var h=this.responseText,i=0,s=h.length;s>i;++i)n+=String.fromCharCode(255&h.charCodeAt(i));return t._isLoaded=!0,void t.trigger("load",new AIMovie(n))}if(!f){for(var h="",d=new Uint8Array(this.response),c=d.byteLength,i=0;c>i;++i)h+=String.fromCharCode(d[i]);return t._isLoaded=!0,void t.trigger("load",new AIMovie(n))}var p=new FileReader;if(p.readAsBinaryString!==e)return p.onload=function(){t._isLoaded=!0,t.trigger("load",new AIMovie(n))},void p.readAsBinaryString(this.response);p.onload=function(){for(var e="",r=new Uint8Array(this.result),o=r.byteLength,i=0;o>i;++i)e+=String.fromCharCode(r[i]);t._isLoaded=!0,t.trigger("load",new AIMovie(n))},p.readAsArrayBuffer(this.response)}},r.send()}function d(){var t=new XMLHttpRequest;if(u=t.responseType!==e,p=t.overrideMimeType!==e&&!u,!u)return void(f=!1);t.open("get","/",!0);try{t.responseType="blob"}catch(r){return void(f=!1)}f=t.response!==e&&"blob"===t.responseType}function c(){g&&document.addEventListener("DOMContentLoaded",function(){var t=document.createElement("script");t.setAttribute("type","text/vbscript"),t.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(t)})}t.AISplitter.Frame=Frame,Frame.prototype={set path(t){"string"==typeof t&&(this._path=t.toString())},get path(){return this._path},set isLoaded(t){},get isLoaded(){return this._isLoaded},set binary(t){},get binary(){return this._binary},set type(t){},get type(){return this._type}},Frame.prototype.read=r,Frame.prototype.readAsAPNG=n,Frame.prototype.readAsXJPEG=o,Frame.prototype.on=i,Frame.prototype.off=s,Frame.prototype.trigger=a,Frame.APNG="APNG",Frame.XJPEG="XJPEG";var u,f,p;d();var g=navigator.userAgent.match(/msie [9.]/i);c()}((this||0).self||global);