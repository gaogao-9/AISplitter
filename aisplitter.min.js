/*!
 * Animation Image Splitter v2.0.0 | MIT Licence | 2014 Kenta Moriuchi (@printf_moriken) | http://git.io/bSTspQ
 *
 * This Program is inspired by APNG-canvas.
 * @copyright 2011 David Mzareulyan
 * @link https://github.com/davidmz/apng-canvas
 * @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
 */
!function(r,t){"use strict";function e(){}function n(r,t){this.width=0,this.height=0,this.frames=[],this._onload=[],this._onerror=[],this.loaded=!1,this._urlToFrames(r,t)}function s(r){for(var t=0,e=0;4>e;++e)t+=r.charCodeAt(e)<<8*(3-e);return t}function o(r){for(var t=0,e=0;2>e;++e)t+=r.charCodeAt(e)<<8*(1-e);return t}function i(r,t){var e="";return e+=a(t.length),e+=r,e+=t,e+=a(d(r+t))}function a(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,255&r)}function h(){this.parts=[]}function d(r){for(var t=-1,e=0,n=r.length;n>e;++e)t=t>>>8^l[255&(t^r.charCodeAt(e))];return-1^t}var p=function(){var r=new XMLHttpRequest;r.open("get","/",!0);try{r.responseType="blob"}catch(e){return!1}return r.response!==t&&"blob"===r.responseType}(),u=navigator.userAgent.match(/msie [9.]/i);u&&document.addEventListener("DOMContentLoaded",function(){var r=document.createElement("script");r.setAttribute("type","text/vbscript"),r.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(r)}),e.prototype.read=function(r,t){var e=new n(r,t);return e},r.AISplitter=e,n.prototype.on=function(r,t){if("load"!==r&&"error"!==r)throw new Error("Don't exist '"+r+"' event");this["_on"+r].push(t)},n.prototype.off=function(r,e){if("load"===r||"error"===r){var n=this["_on"+r];if("function"==typeof e)for(var s=0,o=n.length;o>s;++s)n[s]===e&&n.splice(s,1);else e===t&&n.splice(0,n.length)}else this.trigger("error",new Error("Don't exist '"+r+"' event"))},n.prototype.trigger=function(r,t){for(var e=this["_on"+r],n=0,s=e.length;s>n;++n)e[n].call(this,t)},n.prototype._loadend=function(){this.loaded=!0,this.trigger("load")},n.prototype._urlToFrames=function(r,e){var n=this,s=new XMLHttpRequest,o=s.responseType!==t;s.open("GET",r,!0),o?s.responseType=p?"blob":"arraybuffer":s.overrideMimeType("text/plain; charset=x-user-defined"),s.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(o)if(p){var r=new FileReader;r.readAsBinaryString!==t?(r.onload=function(){n._switchType(this.result,e)},r.readAsBinaryString(this.response)):(r.onload=function(){for(var r="",t=new Uint8Array(this.result),s=t.byteLength,o=0;s>o;++o)r+=String.fromCharCode(t[o]);n._switchType(r,e)},r.readAsArrayBuffer(this.response))}else{for(var s="",i=new Uint8Array(this.response),a=i.byteLength,h=0;a>h;++h)s+=String.fromCharCode(i[h]);n._switchType(s,e)}else{var d="";if(u)for(var f=IEBinaryToBinStr(this.responseBody),h=0,g=f.length;g>h;++h){var l=f.charCodeAt(h);d+=String.fromCharCode(255&l,l>>8&255)}else for(var s=this.responseText,h=0,c=s.length;c>h;++h)d+=String.fromCharCode(255&s.charCodeAt(h));n._switchType(d,e)}else 4==this.readyState&&n.trigger("error",new Error("Can't read file"))},s.send()},n.prototype._switchType=function(r,t){"APNG"===t?this._parseAPNG(r):"XJPEG"===t?this._parseXJPEG(r):this.trigger("error",new Error("Don't support type"))},n.prototype._parseAPNG=function(r){if(r.substr(0,8)!==f)return void this.trigger("error",new Error("This file is not PNG"));var t,e,n,d,p="",u="",g=!1,l=8,c=null;do{switch(e=s(r.substr(l,4)),n=r.substr(l+4,4)){case"IHDR":d=r.substr(l+8,e),t=d,this.width=s(d.substr(0,4)),this.height=s(d.substr(4,4));break;case"acTL":g=!0,this.numPlays=s(r.substr(l+12,4));break;case"fcTL":c&&this.frames.push(c),d=r.substr(l+8,e),c={},c.width=s(d.substr(4,4)),c.height=s(d.substr(8,4)),c.left=s(d.substr(12,4)),c.top=s(d.substr(16,4));var y=o(d.substr(20,2)),v=o(d.substr(22,2));0===v&&(v=100),c.delay=1e3*y/v,c.delay<=10&&(c.delay=100),this.playTime+=c.delay,c.disposeOp=d.charCodeAt(24),c.blendOp=d.charCodeAt(25),c.dataParts=[];break;case"fdAT":c&&c.dataParts.push(r.substr(l+12,e-4));break;case"IDAT":c&&c.dataParts.push(r.substr(l+8,e));break;case"IEND":u=r.substr(l,e+12);break;default:p+=r.substr(l,e+12)}l+=e+12}while("IEND"!==n&&l<r.length);if(c&&this.frames.push(c),c=null,!g)return void this.trigger("error",new Error("Non-animated PNG"));for(var b=0,m=this,w=0,C=this.frames.length;C>w;++w){var E=new Image;c=this.frames[w],c.img=E,E.onload=function(){++b,b===m.frames.length&&m._loadend()},E.onerror=function(){m.trigger("error",new Error("Image creation error"))};var T=new h;T.append(f),t=a(c.width)+a(c.height)+t.substr(8),T.append(i("IHDR",t)),T.append(p);for(var A=0;A<c.dataParts.length;++A)T.append(i("IDAT",c.dataParts[A]));T.append(u),E.src=T.getUrl("image/png"),delete c.dataParts}},n.prototype._parseXJPEG=function(r){var t=this,e=String.fromCharCode(255),n=e+String.fromCharCode(216),s=e+String.fromCharCode(217),i=r.match(new RegExp(n+"[\\s\\S]+?"+s,"g"));if(!("length"in i))return void this.trigger("error",new Error("Can't read JPEG Binary String"));for(var a=function(){if(r.substr(9,12)!==g)return null;for(var e=0,n=1,s=0;4>s;++s)e+=r.charCodeAt(32+s)*n,n*=256;return e/=1e3,t.playTime=0,e}(),d=function(){for(var r=[],t=192;207>=t;)196!==t&&200!==t&&204!==t&&r.push(String.fromCharCode(t)),++t;return new RegExp(e+"["+r.join("")+"]")}(),p=0,u=i.length;u>p;++p){var f={},l=i[p].search(d);f.height=o(i[p].substr(l+5,2)),f.width=o(i[p].substr(l+7,2)),0===p?(this.height=f.height,this.width=f.width,f.top=f.left=0):(f.top=(this.height-f.height)/2,f.left=(this.width-f.width)/2),null!==a&&(f.delay=a,this.playTime+=a),this.frames.push(f)}if(i.length!==this.frames.length)return void this.trigger("error",new Error("Shotage JPEG SOF data"));for(var c=0,p=0,u=this.frames.length;u>p;++p){var y=new Image;this.frames[p].img=y,y.onload=function(){++c,c===t.frames.length&&t._loadend()},y.onerror=function(){t.trigger("error",new Error("Image creation error"))};var v=new h;v.append(i[p]),y.src=v.getUrl("image/jpeg")}};var f=String.fromCharCode(137,80,78,71,13,10,26,10),g="AVI ";h.prototype.append=function(r){this.parts.push(r)},h.prototype.getUrl=function(t){return r.btoa?"data:"+t+";base64,"+btoa(this.parts.join("")):"data:"+t+","+escape(this.parts.join(""))};for(var l=new Array(256),c=0;256>c;++c){for(var y=c,v=0;8>v;++v)y=1&y?3988292384^y>>>1:y>>>1;l[c]=y}}(this);